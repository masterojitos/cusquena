/*! Facebook Friend Selector | Copyright (c) 2013 Coders' Grave - http://codersgrave.com */
var fs_selected_friends;!function(e,t,s,i){"use strict";var n,l,a,o={},r=!1,d=!1,f=0,c=0,u=1,h="",p="http://developers.facebook.com/docs/reference/javascript/",v=function(){return FB===i?(alert("Facebook integration is not defined. View "+p),!1):(o=s.extend(!0,{},G,o),o.onPreStart(),o.max>0&&null!==o.max&&(o.showSelectedCount=!0,o.showButtonSelectAll=!1),m(),void o.onStart())},b=function(){l.fadeOut(400,function(){n.empty(),l.remove(),C(),a.fadeOut(400,function(){a.remove()})}),r=!1,d=!1,o.onClose()},g=function(){var e=[];if(s("input.fs-friends:checked").each(function(){e.push(parseInt(s(this).val().split("-")[1],10))}),o.facebookInvite===!0){var t=e.join();FB.ui({method:"apprequests",message:o.lang.facebookInviteMessage,to:t},function(t){null!==t&&(o.onSubmit(e),o.closeOnSubmit===!0&&b())})}else o.onSubmit(e),o.closeOnSubmit===!0&&b()},m=function(){if(r!==!0){r=!0,s("body").append(a=s('<div id="fs-overlay"></div>'),l=s('<div id="fs-dialog-box-wrap"></div>')),l.append('<div class="fs-dialog-box-bg" id="fs-dialog-box-bg-n"></div><div class="fs-dialog-box-bg" id="fs-dialog-box-bg-ne"></div><div class="fs-dialog-box-bg" id="fs-dialog-box-bg-e"></div><div class="fs-dialog-box-bg" id="fs-dialog-box-bg-se"></div><div class="fs-dialog-box-bg" id="fs-dialog-box-bg-s"></div><div class="fs-dialog-box-bg" id="fs-dialog-box-bg-sw"></div><div class="fs-dialog-box-bg" id="fs-dialog-box-bg-w"></div><div class="fs-dialog-box-bg" id="fs-dialog-box-bg-nw"></div>'),l.append(n=s('<div id="fs-dialog-box-content"></div>'));var t='<div id="fs-dialog" class="fs-color-'+o.color+'"><h2 id="fs-dialog-title"><span>'+o.lang.title+'</span></h2><div id="fs-filter-box"><div id="fs-input-wrap"><input type="text" id="fs-input-text" title="'+o.lang.searchText+'" /><a href="javascript:{}" id="fs-reset">Reset</a></div></div><div id="fs-user-list"><ul></ul></div>'+(o.oneByOne?"":'<div id="fs-filters-buttons"><div id="fs-filters"><a href="javascript:{}" id="fs-show-selected"><span>'+o.lang.buttonShowSelected+'</span></a></div><div id="fs-dialog-buttons"><a href="javascript:{}" id="fs-submit-button" class="fs-button"><span>'+o.lang.buttonSubmit+'</span></a><a href="javascript:{}" id="fs-cancel-button" class="fs-button"><span>'+o.lang.buttonCancel+"</span></a></div></div>")+"</div>";n.html(t),x(),B(!0),k(),_(),s(e).resize(function(){B(!1)})}},x=function(){s("#fs-user-list").append('<div id="fs-loading"></div>'),o.addUserGroups&&!o.facebookInvite?FB.api("/","POST",{batch:[{method:"GET",relative_url:"me/friends"},{method:"GET",relative_url:"me/groups"}]},function(e){S(e)}):FB.api("/me/friends",function(e){S(e)})},S=function(e){if(e.error)return alert(o.lang.fbConnectError),b(),!1;var t=[];if(o.addUserGroups&&!o.facebookInvite){var t=s.parseJSON(e[0].body).data;s.merge(t,s.parseJSON(e[1].body).data)}else t=e.data;var i=null!==o.maxFriendsCount&&o.maxFriendsCount>0;(o.showRandom===!0||i===!0)&&(t=F(e.data));for(var n=0,l=0;n<t.length&&!(i&&o.maxFriendsCount<=l);n++)s.inArray(parseInt(t[n].id,10),o.getStoredFriends)>=0&&(y(n,t,!0),l++);for(n in fs_selected_friends)o.excludeIds.push(fs_selected_friends[n]);for(var a=0;a<t.length&&!(i&&o.maxFriendsCount<=a+o.getStoredFriends.length);a++)s.inArray(parseInt(t[a].id,10),o.excludeIds)>=0||s.inArray(parseInt(t[a].id,10),o.getStoredFriends)<=-1&&y(a,t,!1);s("#fs-loading").remove()},y=function(e,t,i){var n=s("<li/>"),l='<a class="fs-anchor" href="javascript://"><input class="fs-fullname" type="hidden" name="fullname[]" value="'+t[e].name.toLowerCase().replace(/\s/gi,"0")+'" />'+(o.oneByOne?"":'<input class="fs-friends" type="checkbox" name="friend[]" value="fs-'+t[e].id+'" />')+'<img class="fs-thumb" src="https://graph.facebook.com/'+t[e].id+'/picture" /><span class="fs-name">'+I(t[e].name,15)+"</span></a>";n.data("id",t[e].id).append(l),s("#fs-user-list ul").append(n),i&&w(n)},k=function(){l.delegate("#fs-cancel-button","click.fs",function(){b()}),l.delegate("#fs-submit-button","click.fs",function(){g()}),s("#fs-dialog input").focus(function(){s(this).val()===s(this)[0].title&&s(this).val("")}).blur(function(){""===s(this).val()&&s(this).val(s(this)[0].title)}).blur(),s("#fs-dialog input").keyup(function(){A(s(this))}),l.delegate("#fs-reset","click.fs",function(){s("#fs-input-text").val(""),A(s("#fs-dialog input")),s("#fs-input-text").blur()}),l.delegate("#fs-user-list li","click.fs",function(){w(s(this))}),s("#fs-show-selected").click(function(){E(s(this))}),s(t).keyup(function(e){27===e.which&&o.enableEscapeButton===!0&&b()}),o.closeOverlayClick===!0&&(a.css({cursor:"pointer"}),a.bind("click.fs",b))},w=function(e){var t=e;if(o.oneByOne)return o.onSubmit(parseInt(t.data("id"),10)),void b();if(t.hasClass("checked"))t.removeClass("checked"),t.find("input.fs-friends").prop("checked",!1),u--,u-1!==s("#fs-user-list li").length&&s("#fs-select-all").text(o.lang.buttonSelectAll);else{var i=O();if(i===!1)return t.find("input.fs-friends").prop("checked",!1),!1;u++,t.addClass("checked"),t.find("input.fs-friends").prop("checked",!0)}R()},C=function(){s("#fs-reset").undelegate("click.fs"),s("#fs-user-list li").undelegate("click.fs"),u=1,s("#fs-select-all").undelegate("click.fs")},I=function(e,t){var s=e.length;return t>=s?e:e.substr(0,t)+"..."},A=function(e){var t=s("#fs-dialog"),i=s("#fs-user-list ul");if(h=s.trim(e.val()),""===h)return s.each(i.children(),function(){s(this).show()}),void(t.has("#fs-summary-box").length&&(1===u?s("#fs-summary-box").remove():s("#fs-result-text").remove()));var n=h.toLowerCase().replace(/\s/gi,"0"),l=s("#fs-user-list .fs-fullname[value*="+n+"]");i.children().hide(),s.each(l,function(){s(this).parents("li").show()});var a="";l.length>0&&h>""?(a=o.lang.summaryBoxResult.replace("{0}",'"'+e.val()+'"'),a=a.replace("{1}",l.length)):a=o.lang.summaryBoxNoResult.replace("{0}",'"'+e.val()+'"'),t.has("#fs-summary-box").length?t.has("#fs-result-text").length?s("#fs-result-text").text(a):s("#fs-summary-box").prepend('<span id="fs-result-text">'+a+"</span>"):s("#fs-filter-box").after('<div id="fs-summary-box"><span id="fs-result-text">'+a+"</span></div>")},B=function(i){f=s(e).width(),c=s(e).height();var n=s(t).height(),r=l.width(),d=l.height(),u=f/2-r/2,h=c/2-d/2;i===!0?a.css({"background-color":o.overlayColor,opacity:o.overlayOpacity,height:n}).fadeIn("fast",function(){l.css({left:u,top:h}).fadeIn()}):(l.stop().animate({left:u,top:h},200),a.css({height:n}))},F=function(e){for(var t,s,i=e.length;i;t=parseInt(Math.random()*i,10),s=e[--i],e[i]=e[t],e[t]=s);return e},O=function(){if(u>o.max&&null!==o.max){var e=o.lang.selectedLimitResult.replace("{0}",o.max);return s(".fs-limit").html('<span class="fs-limit fs-full">'+e+"</span>"),!1}},R=function(){if(u>1&&o.showSelectedCount===!0){var e=o.lang.selectedCountResult.replace("{0}",u-1);s("#fs-dialog").has("#fs-summary-box").length?s("#fs-dialog").has(".fs-limit.fs-count").length?s(".fs-limit").text(e):s("#fs-summary-box").append('<span class="fs-limit fs-count">'+e+"</span>"):s("#fs-filter-box").after('<div id="fs-summary-box"><span class="fs-limit fs-count">'+e+"</span></div>")}else""===h?s("#fs-summary-box").remove():s(".fs-limit").remove()},j=function(){s("#fs-user-list li").removeClass("checked"),s("#fs-user-list input.fs-friends").prop("checked",!1),u=1},_=function(){o.showButtonSelectAll===!0&&null===o.max&&(s("#fs-show-selected").before('<a href="javascript:{}" id="fs-select-all"><span>'+o.lang.buttonSelectAll+"</span></a> - "),l.delegate("#fs-select-all","click.fs",function(){u-1!==s("#fs-user-list li").length?(s("#fs-user-list li:hidden").show(),j(),s("#fs-user-list li").each(function(){w(s(this))}),s("#fs-select-all").text(o.lang.buttonDeselectAll),d===!0&&(d=!1,s("#fs-show-selected").text(o.lang.buttonShowSelected))):(j(),R(),s("#fs-select-all").text(o.lang.buttonSelectAll))}))},E=function(e){var t=s("#fs-user-list ul"),i=t.find("li"),n=t.find("li.checked");(0!==n.length&&n.length!==i.length||d===!0)&&(d===!0?(e.removeClass("active").text(o.lang.buttonShowSelected),t.children().show(),d=!1):(e.addClass("active").text(o.lang.buttonShowAll),t.children().hide(),s.each(n,function(){s(this).show()}),d=!0))},G={max:null,excludeIds:[],getStoredFriends:[],closeOverlayClick:!0,enableEscapeButton:!0,overlayOpacity:"0.3",overlayColor:"#000",closeOnSubmit:!1,showSelectedCount:!0,showButtonSelectAll:!0,addUserGroups:!1,color:"default",lang:{title:"Friend Selector",buttonSubmit:"Send",buttonCancel:"Cancel",buttonSelectAll:"Select All",buttonDeselectAll:"Deselect All",buttonShowSelected:"Show Selected",buttonShowAll:"Show All",summaryBoxResult:"{1} best results for {0}",summaryBoxNoResult:"No results for {0}",searchText:"Enter a friend's name",fbConnectError:"You must connect to Facebook to see this.",selectedCountResult:"You have choosen {0} people.",selectedLimitResult:"Limit is {0} people.",facebookInviteMessage:"Invite message"},maxFriendsCount:null,oneByOne:!1,showRandom:!1,facebookInvite:!0,onPreStart:function(){return null},onStart:function(){return null},onClose:function(){return null},onSubmit:function(){return null}};s.fn.fSelector=function(e){return this.unbind("click.fs"),this.bind("click.fs",function(){o=e,v()}),this}}(window,document,jQuery);
